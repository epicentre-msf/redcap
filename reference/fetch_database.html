<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fetch records from multiple REDCap forms, returning separate list elements for each form — fetch_database • redcap</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fetch records from multiple REDCap forms, returning separate list elements for each form — fetch_database"><meta name="description" content="Wrapper to fetch_records that's vectorized over forms (i.e. instruments).
Returns a list whose elements are tibble-style data
frames corresponding to each requested form."><meta property="og:description" content="Wrapper to fetch_records that's vectorized over forms (i.e. instruments).
Returns a list whose elements are tibble-style data
frames corresponding to each requested form."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redcap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epicentre-msf/redcap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fetch records from multiple REDCap forms, returning separate list elements for each form</h1>
      <small class="dont-index">Source: <a href="https://github.com/epicentre-msf/redcap/blob/main/R/fetch_database.R" class="external-link"><code>R/fetch_database.R</code></a></small>
      <div class="d-none name"><code>fetch_database.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wrapper to <code><a href="fetch_records.html">fetch_records</a></code> that's vectorized over forms (i.e. instruments).
Returns a list whose elements are <code><a href="https://tibble.tidyverse.org/reference/tbl_df-class.html" class="external-link">tibble</a></code>-style data
frames corresponding to each requested form.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fetch_database</span><span class="op">(</span></span>
<span>  <span class="va">conn</span>,</span>
<span>  forms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  names_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>,</span>
<span>  records <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  records_omit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  id_field <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rm_empty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  value_labs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  value_labs_fetch_raw <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  header_labs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  checkbox_labs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_factors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  times_chron <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  date_range_begin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  date_range_end <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fn_dates <span class="op">=</span> <span class="va">parse_date</span>,</span>
<span>  fn_dates_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>orders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ymd"</span>, <span class="st">"dmY"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fn_datetimes <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="va"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span>,</span>
<span>  fn_datetimes_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>orders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ymd HMS"</span>, <span class="st">"Ymd HM"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span><span class="op">)</span>,</span>
<span>  dag <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  double_resolve <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  double_remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  double_sep <span class="op">=</span> <span class="st">"--"</span>,</span>
<span>  fns <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-conn">conn<a class="anchor" aria-label="anchor" href="#arg-conn"></a></dt>
<dd><p>A REDCap API connection object (created with <code><a href="rconn.html">rconn</a></code>)</p></dd>


<dt id="arg-forms">forms<a class="anchor" aria-label="anchor" href="#arg-forms"></a></dt>
<dd><p>Character vector of forms (i.e. instruments) to fetch data for.
Set to <code>NULL</code> (the default) to fetch all forms in the project.</p></dd>


<dt id="arg-names-fn">names_fn<a class="anchor" aria-label="anchor" href="#arg-names-fn"></a></dt>
<dd><p>Function for creating custom list element names given a
vector of form names. Defaults to an identity function in which case
element names will correspond exactly to form names.</p></dd>


<dt id="arg-records">records<a class="anchor" aria-label="anchor" href="#arg-records"></a></dt>
<dd><p>Character vector of record IDs to fetch. Set to <code>NULL</code> (the
default) to fetch all record IDs corresponding to the selected form(s).</p></dd>


<dt id="arg-records-omit">records_omit<a class="anchor" aria-label="anchor" href="#arg-records-omit"></a></dt>
<dd><p>Character vector of record IDs to ignore. Set to <code>NULL</code>
(the default) to <em>not</em> ignore any records. If a given record ID appears in
both argument <code>records</code> and <code>records_omit</code>, argument <code>records_omit</code> takes
precedence and that record will not be returned.</p></dd>


<dt id="arg-id-field">id_field<a class="anchor" aria-label="anchor" href="#arg-id-field"></a></dt>
<dd><p>Logical indicating whether to always include the 'record ID'
field (defined in REDCap to be the first variable in the project codebook)
in the API request, even if it's not specified in argument <code>fields</code>.
Defaults to <code>TRUE</code>.</p>
<p>The record ID field is defined within the first form of a REDCap project,
and so API requests for other forms will not include the record ID field by
default (unless it's explicitly requested with argument <code>fields</code>). The
<code>id_field</code> argument is a shortcut to avoid having to always explicitly
request the record ID field.</p></dd>


<dt id="arg-rm-empty">rm_empty<a class="anchor" aria-label="anchor" href="#arg-rm-empty"></a></dt>
<dd><p>Logical indicating whether to remove rows for which all
fields from the relevant form(s) are missing. See section <strong>Removing empty
rows</strong>. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-value-labs">value_labs<a class="anchor" aria-label="anchor" href="#arg-value-labs"></a></dt>
<dd><p>Logical indicating whether to return value labels (<code>TRUE</code>)
or raw values (<code>FALSE</code>) for categorical REDCap variables (radio, dropdown,
yesno, checkbox). Defaults to <code>TRUE</code> to return labels.</p></dd>


<dt id="arg-value-labs-fetch-raw">value_labs_fetch_raw<a class="anchor" aria-label="anchor" href="#arg-value-labs-fetch-raw"></a></dt>
<dd><p>Logical indicating whether to request raw values
for categorical REDCap variables (radio, dropdown, yesno, checkbox), which
are then transformed to labels in a separate step when <code>value_labs = TRUE</code>.
Primarily used for troubleshooting issues with the REDCap API returning
fewer records than expected when given certain combinations of request
parameters.</p></dd>


<dt id="arg-header-labs">header_labs<a class="anchor" aria-label="anchor" href="#arg-header-labs"></a></dt>
<dd><p>Logical indicating whether to export column names as
labels (<code>TRUE</code>) or raw variable names (<code>FALSE</code>). Defaults to <code>FALSE</code> to
return raw variable names.</p></dd>


<dt id="arg-checkbox-labs">checkbox_labs<a class="anchor" aria-label="anchor" href="#arg-checkbox-labs"></a></dt>
<dd><p>Logical indicating whether to export checkbox labels
(<code>TRUE</code>) or statuses (i.e. "Unchecked" or "Checked") (<code>FALSE</code>). Defaults to
<code>FALSE</code> to export statuses. Note this argument is only relevant when
<code>value_labs</code> is <code>TRUE</code> — if <code>value_labs</code> is <code>FALSE</code> checkbox variables will
always be exported as raw values (usually "0"/"1").</p></dd>


<dt id="arg-use-factors">use_factors<a class="anchor" aria-label="anchor" href="#arg-use-factors"></a></dt>
<dd><p>Logical indicating whether categorical REDCap variables
(radio, dropdown, yesno, checkbox) should be returned as factors. Factor
levels can either be raw values (e.g. "0"/"1") or labels (e.g. "No"/"Yes")
depending on arguments <code>value_labs</code> and <code>checkbox_labs</code>. Defaults to
<code>FALSE</code>.</p></dd>


<dt id="arg-times-chron">times_chron<a class="anchor" aria-label="anchor" href="#arg-times-chron"></a></dt>
<dd><p>Logical indicating whether to reclass time variables using
<a href="https://rdrr.io/pkg/chron/man/dates.html" class="external-link">chron::times</a> (<code>TRUE</code>) or leave as character HH:MM format (<code>FALSE</code>).
Defaults to <code>TRUE</code>. Note this only applies to variables of REDCap type
"Time (HH:MM)", and not "Time (MM:SS)".</p></dd>


<dt id="arg-date-range-begin">date_range_begin<a class="anchor" aria-label="anchor" href="#arg-date-range-begin"></a></dt>
<dd><p>Fetch only records created or modified <em>after</em> a
given date-time. Use format "YYYY-MM-DD HH:MM:SS" (e.g., "2017-01-01
00:00:00" for January 1, 2017 at midnight server time). Defaults to NULL to
omit a lower time limit.</p></dd>


<dt id="arg-date-range-end">date_range_end<a class="anchor" aria-label="anchor" href="#arg-date-range-end"></a></dt>
<dd><p>Fetch only records created or modified <em>before</em> a given
date-time. Use format "YYYY-MM-DD HH:MM:SS" (e.g., "2017-01-01 00:00:00"
for January 1, 2017 at midnight server time). Defaults to NULL to omit a
lower time limit.</p></dd>


<dt id="arg-fn-dates">fn_dates<a class="anchor" aria-label="anchor" href="#arg-fn-dates"></a></dt>
<dd><p>Function to parse REDCap date variables. Defaults to
<code>parse_date</code>, an internal wrapper to <code><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">lubridate::parse_date_time</a></code>. If
date variables have been converted to numeric (e.g. by writing to Excel),
set to e.g. <code><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">lubridate::as_date</a></code> to convert back to dates.</p></dd>


<dt id="arg-fn-dates-args">fn_dates_args<a class="anchor" aria-label="anchor" href="#arg-fn-dates-args"></a></dt>
<dd><p>List of arguments to pass to <code>fn_dates</code>. Can set to
empty list <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> if using a function that doesn't take any arguments.</p></dd>


<dt id="arg-fn-datetimes">fn_datetimes<a class="anchor" aria-label="anchor" href="#arg-fn-datetimes"></a></dt>
<dd><p>Function to parse REDCap datetime variables. Defaults to
<code><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">lubridate::parse_date_time</a></code>.</p></dd>


<dt id="arg-fn-datetimes-args">fn_datetimes_args<a class="anchor" aria-label="anchor" href="#arg-fn-datetimes-args"></a></dt>
<dd><p>List of arguments to pass to <code>fn_datetimes</code>. Can set
to empty list <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> if using a function that doesn't take any arguments.</p></dd>


<dt id="arg-na">na<a class="anchor" aria-label="anchor" href="#arg-na"></a></dt>
<dd><p>Character vector of strings to interpret as missing values. Passed
to <a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv</a>. Defaults to <code>c("", "NA")</code>.</p></dd>


<dt id="arg-dag">dag<a class="anchor" aria-label="anchor" href="#arg-dag"></a></dt>
<dd><p>Logical indicating whether to export the
<code>redcap_data_access_group</code> field (if used in the project). Defaults to
<code>TRUE</code>.</p></dd>


<dt id="arg-double-resolve">double_resolve<a class="anchor" aria-label="anchor" href="#arg-double-resolve"></a></dt>
<dd><p>Logical indicating whether to resolve double-entries
(i.e. records entered in duplicate using REDCap's Double Data Entry
module), by filtering to the lowest entry number associated with each
unique record.</p>
<p>If a project uses double-entry, the record IDs returned by an "Export
Records" API request will be a concatenation of the normal record ID and
the entry number (1 or 2), normally separated by "–" (e.g. "P0285–1"). To
resolve double entries we move the entry number portion of the ID to its
own column (<code>entry</code>), identify all entries belonging to the same unique
record, and retain only the row with the lowest entry number for each
unique record.</p>
<p>Unique records are identified using the record ID column (after separating
the entry number portion), and any of the following columns when present
(accounting for argument <code>header_labs</code>): redcap_event_name (Redcap Event),
redcap_repeat_instrument (Repeat Instrument), redcap_repeat_instance
(Repeat Instance).</p></dd>


<dt id="arg-double-remove">double_remove<a class="anchor" aria-label="anchor" href="#arg-double-remove"></a></dt>
<dd><p>Logical indicating whether to <em>remove</em> double-entries
(i.e. records entered in duplicate using REDCap's Double Data Entry
module), by filtering out records where the record ID field contains
pattern <code>double_sep</code> (see next argument), so that only merged records
remain.</p></dd>


<dt id="arg-double-sep">double_sep<a class="anchor" aria-label="anchor" href="#arg-double-sep"></a></dt>
<dd><p>If <code>double_resolve</code> is <code>TRUE</code>, the string separator used to
split the record ID field into the record ID and entry number. Defaults to
"–".</p></dd>


<dt id="arg-fns">fns<a class="anchor" aria-label="anchor" href="#arg-fns"></a></dt>
<dd><p>Optional list of one or more functions to apply to each list
element (i.e. each form). Could be used e.g. to filter out record IDs from
test entries, create derived variables, etc. Each function should take a
data frame returned by <code><a href="fetch_records.html">fetch_records</a></code> as its first argument.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of <code><a href="https://tibble.tidyverse.org/reference/tbl_df-class.html" class="external-link">tibble</a></code>-style data frames corresponding to each
of the requested forms.</p>
    </div>
    <div class="section level2">
    <h2 id="removing-empty-rows">Removing empty rows<a class="anchor" aria-label="anchor" href="#removing-empty-rows"></a></h2>


<p>Depending on the database design, an "Export Records" API request can
sometimes return empty rows, representing forms for which no data has been
collected. For example, if forms <strong>F1</strong> and <strong>F2</strong> are part of the same
event, and participant "P001" has form data for <strong>F2</strong> but not <strong>F1</strong>, an API
request for <strong>F1</strong> will include a row for participant "P001" where all
<strong>F1</strong>-specific fields are empty.</p>
<p>If argument <code>rm_empty</code> is <code>TRUE</code> (the default), <code><a href="fetch_records.html">fetch_records()</a></code> will filter
out such rows. The check for empty rows is based only on fields that are
specific to the form(s) specified in argument <code>forms</code> — i.e. it excludes the
record ID field, and generic fields like <code>redcap_event_name</code>,
<code>redcap_data_access_group</code>, etc. The check for empty rows also accounts for
checkbox fields, which, if argument <code>checkbox_labs</code> is <code>FALSE</code>, will be set
to "Unchecked" in an empty form (rather than missing per se).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="rconn.html">rconn</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  url <span class="op">=</span> <span class="st">"https://redcap.msf.fr/api/"</span>,</span></span>
<span class="r-in"><span>  token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"MY_REDCAP_TOKEN"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">fetch_database</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">conn</span>,</span></span>
<span class="r-in"><span>  forms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_form1"</span>, <span class="st">"my_form2"</span>, <span class="st">"my_form3"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a custom fn to format the 'participant_id' column of each form</span></span></span>
<span class="r-in"><span><span class="co"># the function must take a data frame as its first argument</span></span></span>
<span class="r-in"><span><span class="va">format_ids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">participant_id</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[^[:alnum:]]+"</span>, <span class="st">"_"</span>, <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">fetch_database</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">conn</span>,</span></span>
<span class="r-in"><span>  forms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_form1"</span>, <span class="st">"my_form2"</span>, <span class="st">"my_form3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">format_ids</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Barks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

