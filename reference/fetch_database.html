<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Wrapper to fetch_records that's vectorized over forms (i.e. instruments).
Returns a list whose elements are tibble-style data
frames corresponding to each requested form."><title>Fetch records from multiple REDCap forms, returning separate list elements
for each form — fetch_database • redcap</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fetch records from multiple REDCap forms, returning separate list elements
for each form — fetch_database"><meta property="og:description" content="Wrapper to fetch_records that's vectorized over forms (i.e. instruments).
Returns a list whose elements are tibble-style data
frames corresponding to each requested form."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redcap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epicentre-msf/redcap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fetch records from multiple REDCap forms, returning separate list elements
for each form</h1>
      <small class="dont-index">Source: <a href="https://github.com/epicentre-msf/redcap/blob/HEAD/R/fetch_database.R" class="external-link"><code>R/fetch_database.R</code></a></small>
      <div class="d-none name"><code>fetch_database.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wrapper to <code><a href="fetch_records.html">fetch_records</a></code> that's vectorized over forms (i.e. instruments).
Returns a list whose elements are <code><a href="https://tibble.tidyverse.org/reference/tbl_df-class.html" class="external-link">tibble</a></code>-style data
frames corresponding to each requested form.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fetch_database</span><span class="op">(</span>
  <span class="va">conn</span>,
  forms <span class="op">=</span> <span class="cn">NULL</span>,
  names_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>,
  records <span class="op">=</span> <span class="cn">NULL</span>,
  records_omit <span class="op">=</span> <span class="cn">NULL</span>,
  id_field <span class="op">=</span> <span class="cn">TRUE</span>,
  rm_empty <span class="op">=</span> <span class="cn">TRUE</span>,
  value_labs <span class="op">=</span> <span class="cn">TRUE</span>,
  header_labs <span class="op">=</span> <span class="cn">FALSE</span>,
  checkbox_labs <span class="op">=</span> <span class="cn">FALSE</span>,
  use_factors <span class="op">=</span> <span class="cn">FALSE</span>,
  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span><span class="op">)</span>,
  dag <span class="op">=</span> <span class="cn">TRUE</span>,
  double_resolve <span class="op">=</span> <span class="cn">FALSE</span>,
  double_sep <span class="op">=</span> <span class="st">"--"</span>,
  fns <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>conn</dt>
<dd><p>A REDCap API connection object (created with <code><a href="rconn.html">rconn</a></code>)</p></dd>
<dt>forms</dt>
<dd><p>Character vector of forms (i.e. instruments) to fetch data for.
Set to <code>NULL</code> (the default) to fetch all forms in the project.</p></dd>
<dt>names_fn</dt>
<dd><p>Function for creating custom list element names given a
vector of form names. Defaults to an identity function in which case
element names will correspond exactly to form names.</p></dd>
<dt>records</dt>
<dd><p>Character vector of record IDs to fetch. Set to <code>NULL</code> (the
default) to fetch all record IDs corresponding to the selected form(s).</p></dd>
<dt>records_omit</dt>
<dd><p>Character vector of record IDs to ignore. Set to <code>NULL</code>
(the default) to <em>not</em> ignore any records. If a given record ID appears in
both argument <code>records</code> and <code>records_omit</code>, argument <code>records_omit</code> takes
precedence and that record will not be returned.</p></dd>
<dt>id_field</dt>
<dd><p>Logical indicating whether to always include the 'record ID'
field (defined in REDCap to be the first variable in the project codebook)
in the API request, even if it's not specified in argument <code>fields</code>.
Defaults to <code>TRUE</code>.</p>
<p>The record ID field is defined within the first form of a REDCap project,
and so API requests for other forms will not include the record ID field by
default (unless it's explicitly requested with argument <code>fields</code>). The
<code>id_field</code> argument is a shortcut to avoid having to always explicitly
request the record ID field.</p></dd>
<dt>rm_empty</dt>
<dd><p>Logical indicating whether to remove rows for which all
fields from the relevant form(s) are missing. See section <strong>Removing empty
rows</strong>. Defaults to <code>TRUE</code>.</p></dd>
<dt>value_labs</dt>
<dd><p>Logical indicating whether to return value labels (<code>TRUE</code>)
or raw values (<code>FALSE</code>) for categorical REDCap variables (radio, dropdown,
yesno, checkbox). Defaults to <code>TRUE</code> to return labels.</p></dd>
<dt>header_labs</dt>
<dd><p>Logical indicating whether to export column names as
labels (<code>TRUE</code>) or raw variable names (<code>FALSE</code>). Defaults to <code>FALSE</code> to
return raw variable names.</p></dd>
<dt>checkbox_labs</dt>
<dd><p>Logical indicating whether to export checkbox labels
(<code>TRUE</code>) or statuses (i.e. "Unchecked" or "Checked") (<code>FALSE</code>). Defaults to
<code>FALSE</code> to export statuses. Note this argument is only relevant when
<code>value_labs</code> is <code>TRUE</code> — if <code>value_labs</code> is <code>FALSE</code> checkbox variables will
always be exported as raw values (usually "0"/"1").</p></dd>
<dt>use_factors</dt>
<dd><p>Logical indicating whether categorical REDCap variables
(radio, dropdown, yesno, checkbox) should be returned as factors. Factor
levels can either be raw values (e.g. "0"/"1") or labels (e.g. "No"/"Yes")
depending on arguments <code>value_labs</code> and <code>checkbox_labs</code>. Defaults to
<code>FALSE</code>.</p></dd>
<dt>na</dt>
<dd><p>Character vector of strings to interpret as missing values. Passed
to <a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv</a>. Defaults to <code>c("", "NA")</code>.</p></dd>
<dt>dag</dt>
<dd><p>Logical indicating whether to export the
<code>redcap_data_access_group</code> field (if used in the project). Defaults to
<code>TRUE</code>.</p></dd>
<dt>double_resolve</dt>
<dd><p>Logical indicating whether to resolve double-entries
(i.e. records entered in duplicate using REDCap's Double Data Entry
module), by filtering to the lowest entry number associated with each
unique record.</p>
<p>If a project uses double-entry, the record IDs returned by an "Export
Records" API request will be a concatenation of the normal record ID and
the entry number (1 or 2), normally separated by "--" (e.g. "P0285--1"). To
resolve double entries we move the entry number portion of the ID to its
own column (<code>entry</code>), identify all entries belonging to the same unique
record, and retain only the row with the lowest entry number for each
unique record.</p>
<p>Unique records are identified using the record ID column (after separating
the entry number portion), and any of the following columns when present
(accounting for argument <code>header_labs</code>): redcap_event_name (Redcap Event),
redcap_repeat_instrument (Repeat Instrument), redcap_repeat_instance
(Repeat Instance).</p></dd>
<dt>double_sep</dt>
<dd><p>If <code>double_resolve</code> is <code>TRUE</code>, the string separator used to
split the record ID field into the record ID and entry number. Defaults to
"--".</p></dd>
<dt>fns</dt>
<dd><p>Optional list of one or more functions to apply to each list
element (i.e. each form). Could be used e.g. to filter out record IDs from
test entries, create derived variables, etc. Each function should take a
data frame returned by <code><a href="fetch_records.html">fetch_records</a></code> as its first argument.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of <code><a href="https://tibble.tidyverse.org/reference/tbl_df-class.html" class="external-link">tibble</a></code>-style data frames corresponding to each
of the requested forms.</p>
    </div>
    <div class="section level2">
    <h2 id="removing-empty-rows">Removing empty rows<a class="anchor" aria-label="anchor" href="#removing-empty-rows"></a></h2>
    

<p>Depending on the database design, an "Export Records" API request can
sometimes return empty rows, representing forms for which no data has been
collected. For example, if forms <strong>F1</strong> and <strong>F2</strong> are part of the same
event, and participant "P001" has form data for <strong>F2</strong> but not <strong>F1</strong>, an API
request for <strong>F1</strong> will include a row for participant "P001" where all
<strong>F1</strong>-specific fields are empty.</p>
<p>If argument <code>rm_empty</code> is <code>TRUE</code> (the default), <code><a href="fetch_records.html">fetch_records()</a></code> will filter
out such rows. The check for empty rows is based only on fields that are
specific to the form(s) specified in argument <code>forms</code> — i.e. it excludes the
record ID field, and generic fields like <code>redcap_event_name</code>,
<code>redcap_data_access_group</code>, etc. The check for empty rows also accounts for
checkbox fields, which, if argument <code>checkbox_labs</code> is <code>FALSE</code>, will be set
to "Unchecked" in an empty form (rather than missing per se).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="rconn.html">rconn</a></span><span class="op">(</span></span>
<span class="r-in">  url <span class="op">=</span> <span class="st">"https://redcap.msf.fr/api/"</span>,</span>
<span class="r-in">  token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"MY_REDCAP_TOKEN"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">fetch_database</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">conn</span>,</span>
<span class="r-in">  forms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_form1"</span>, <span class="st">"my_form2"</span>, <span class="st">"my_form3"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># use a custom fn to format the 'participant_id' column of each form</span></span>
<span class="r-in"><span class="co"># the function must take a data frame as its first argument</span></span>
<span class="r-in"><span class="va">format_ids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">participant_id</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[^[:alnum:]]+"</span>, <span class="st">"_"</span>, <span class="va">x</span><span class="op">$</span><span class="va">participant_id</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">x</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">fetch_database</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">conn</span>,</span>
<span class="r-in">  forms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_form1"</span>, <span class="st">"my_form2"</span>, <span class="st">"my_form3"</span><span class="op">)</span>,</span>
<span class="r-in">  fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">format_ids</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Patrick Barks.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

